# ç§»åŠ¨ç«¯APM å»ºè®¾æ–¹æ¡ˆè°ƒç ”

# åè¯è§£é‡Šï¼š

- TTIï¼šç”¨æˆ·å®é™…å¯äº¤äº’æ—¶é•¿. ï¼ˆå®¢æˆ·ç«¯ï¼šé¦–å±å®ŒæˆåŠ è½½ï¼Œå¹¶å¯å®é™…ç‚¹å‡»ã€æ»‘åŠ¨ï¼‰.
- LCPï¼šæœ€å¤§å†…å®¹ç»˜åˆ¶å®Œæˆæ—¶é•¿.ï¼ˆå®¢æˆ·ç«¯ï¼šå¾€å¾€æ˜¯é¦–å±å…¨è²Œå®Œæˆæ¸²æŸ“æ—¶é—´èŠ‚ç‚¹.ï¼‰
- FMPï¼šæ ¸å¿ƒç»„ä»¶ç»˜åˆ¶å®Œæˆæ—¶é•¿. ï¼ˆå®¢æˆ·ç«¯ï¼šå¯¹åº”é¡µé¢æ ¸å¿ƒç»„ä»¶å®Œæˆç»˜åˆ¶æ—¶é•¿ï¼‰.
- è·³å‡ºç‡ï¼š åœ¨å¯¹åº”é¡µé¢ã€æ¨¡å—**æœªå®Œæˆå®Œå…¨åŠ è½½**ä¹‹å‰è·³å‡ºçš„æ¬¡æ•° / æ€»è¿›å…¥æ¬¡æ•°. ï¼ˆä¸ºï¼š**è´Ÿå‘æŒ‡æ ‡**ï¼‰
- ç§’å¼€ç‡ï¼šå¯ä»¥åŸºäº FMP â†’ LCP â†’ TTI ä¸‰é¡¹æŒ‡æ ‡ï¼ˆps: éš¾åº¦ä¸ä¸€ï¼‰æ¥ä»»æ„åˆ¶å®šä¸ºåˆ†å­ï¼Œ å…¶åˆ†æ¯ä¸ºç‚¹å‡»å¯¹åº”è·³è½¬æŒ‰é’®ä¸ºèµ·å§‹æ—¶é—´.
- Heartï¼šä¸ºGoogle 2010å¹´æ¨å‡ºçš„ç”¨æˆ·ä½“éªŒæ¨¡å‹æ¡†æ¶ï¼Œå¹¶å°†ç”¨æˆ·ä½“éªŒæ‹†è§£å‡º**äº”å¤§æ–¹å‘**å¹¶åŠ ä»¥**å®šä¹‰åŠæµ‹é‡æ–¹æ³•.**
- GSMï¼šæ˜¯Google Heart åŒæœŸæ¨å‡ºçš„ç›®æ ‡åˆ¶å®šæ–¹æ³•è®º. ä»¥**Goal** â†’ **Signal** â†’ **Metrics** ä¸ºå¯¼å‘. ç”¨äºæ ¡éªŒç›®æ ‡è¾¾æˆæ•ˆæœåŠè´Ÿåé¦ˆæ”¶é›†æ–¹æ¡ˆ.
- ä»»åŠ¡å®Œæˆç‡ï¼Œå¦‚ï¼š
- åœ¨æˆäº¤ç›®æ ‡ä¸‹ï¼Œå¯ä»¥ç†è§£ U2O è½¬åŒ–ç‡ .å°±æ˜¯ä»»åŠ¡å®Œæˆç‡
- åœ¨Steamç»‘å®šç›®æ ‡ä¸‹ï¼Œå¯ä»¥ç†è§£ Steam ç»‘å®šæˆåŠŸç‡. å°±æ˜¯ä»»åŠ¡å®Œæˆç‡

# ä¸€ã€Why - ç§»åŠ¨ç«¯ç”¨æˆ·ä½“éªŒæ¨¡å‹

åŸºäºGoogle Heart æ¨¡å‹åŠ Google GSM æ–¹æ³•è®ºã€‚ å¯ä»¥æ¸…æ™°çš„ç†è§£åˆ°ä½¿ç”¨ä½•ç§æ¡†æ¶ åŠ æ–¹æ³•æ¥åˆ¶å®š/æµ‹é‡ä¸€æ¬¾æ‹¥æœ‰å¥½çš„ä½“éªŒçš„åº”ç”¨è½¯ä»¶.

ç›®å‰å›½å†…é™¤å‡ å®¶å¤§å‹äº¤äº’å›¢é˜Ÿä»¥å¤–ï¼Œæ›´å¤šçš„æ˜¯å»ç›´æ¥æ²¿ç”¨ **Google Heart** æ¨¡å‹ ç»“åˆ **Google GSM** æ–¹æ³•è®º æ¥åˆ¶å®šç”¨æˆ·ä½“éªŒæå‡ç›®æ ‡ï¼Œä»¥ä¸‹ä¸ºä¸ºå¤§è‡´å‘ˆç°ï¼š

| **ç»´åº¦** | **ç›®æ ‡** | **ä¿¡å·/åŠ¨ä½œ** | **æŒ‡æ ‡** | **è¯„ä¼°æ–¹æ³•** |
| --- | --- | --- | --- | --- |
| æ„‰æ‚¦åº¦ | ç”¨æˆ·è§‰å¾—å¯¹å…¶æœ‰å¸®åŠ©çš„ï¼Œä½¿ç”¨äº§å“æ„Ÿè§‰çš„æ„‰æ‚¦çš„. | 1. æ»¡æ„åº¦æ˜¯å¦æœ‰æ‰€ä¸‹é™ï¼Ÿ2. äº§å“è¯„åˆ†5åˆ†å±…å¤šï¼Ÿ3. æ„¿æ„æ¨èç»™åˆ«äººä½¿ç”¨çš„. | æ»¡æ„åº¦ã€NPSã€æ˜“ç”¨æ€§ã€æ„¿æ„è½¬å‘åˆ†äº« | NPSè°ƒç ”é—®å·ï¼Œç”¨æˆ·è¡Œä¸ºåŸ‹ç‚¹ + æ•°æ®åˆ†æï¼Œ APMç³»ç»Ÿ. |
| å‚ä¸åº¦ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰ | ç”¨æˆ·å¯¹äº§å“å†…å®¹æ„Ÿå…´è¶£å¹¶ä¸”æ„¿æ„ç»å¸¸ä½¿ç”¨ | 1. ä¸€æ®µæ—¶é—´å†…å¤šæ¬¡è®¿é—®äº§å“æˆ–è€…ä½¿ç”¨æŸä¸ªåŠŸèƒ½ | å¹³å‡ç”¨æˆ·çš„æ¯å‘¨çš„è®¿é—®é¢‘ç‡ï¼Œ7å¤©å†…çš„æ´»è·ƒç”¨æˆ·æ•°é‡ã€çƒ­é—¨æœŸé—´é‡å¤è®¿é—®é‡ | ç”¨æˆ·è¡Œä¸ºåŸ‹ç‚¹ + æ•°æ®åˆ†æ |
| æ¥å—åº¦ï¼ˆæ–°åŠŸèƒ½ï¼‰ | ç”¨æˆ·çœ‹åˆ°æ–°äº§å“æˆ–åŠŸèƒ½ä½¿ç”¨æ„æ„¿åº¦ | 1. æ–°äº§å“åŠŸèƒ½è®¿é—®é‡é«˜2. æ„¿æ„æ³¨å†Œ3. æ„¿æ„ä½¿ç”¨æ–°åŠŸèƒ½ | é¡µé¢æµè§ˆé‡ï¼Œäº§å“è®¿é—®é‡ï¼Œç‚¹å‡»ç‡ã€æ³¨å†Œç‡ã€ä¸‹è½½é‡ã€æ“ä½œæ—¶é•¿ç­‰ç­‰ | ç”¨æˆ·è¡Œä¸ºåŸ‹ç‚¹ + æ•°æ®åˆ†æ |
| ç•™å­˜ç‡ | åœ¨ä¸€ä¸ªæ—¶é—´å†…ç”¨æˆ·æ„¿æ„å›æ¥ç»§ç»­ä½¿ç”¨äº§å“ | 1. æ´»è·ƒåº¦é«˜2. æµå¤±ç‡ä½3. å¤è´­ç‡é«˜ | æ¬¡æ—¥ç•™å­˜ç‡ï¼Œ7æ—¥ç•™å­˜ç‡ï¼Œ30æ—¥ç•™å­˜ç‡ã€‚å¤è´­ç‡ | ç”¨æˆ·è¡Œä¸ºåŸ‹ç‚¹ + æ•°æ®åˆ†æ |
| ä»»åŠ¡å®Œæˆç‡ | ç”¨æˆ·èƒ½å¤Ÿé«˜æ•ˆã€å‡†ç¡®çš„å®ŒæˆæŒ‡å®šä»»åŠ¡ | 1. æŒ‡å®šé¡µé¢ä¸­ã€æŒ‡å®šæŒ‰é’®ç‚¹å‡»ï¼ˆä¸‹ä¸€æ­¥/é€€å‡ºï¼‰2. å®é™…é¡µé¢è·³è½¬3. ä»»åŠ¡å®Œæˆæ—¶é—´4. æ“ä½œè¿‡ç¨‹å‡ºé”™äº‹ä»¶ | é¡µé¢åœç•™æ—¶é•¿ã€è½¬åŒ–ç‡ã€å¯ç”¨ç‡ã€é”™è¯¯ç‡ã€é¡µé¢è·³å‡ºç‡ã€ä»»åŠ¡å®Œæˆç™¾åˆ†æ¯” | ç”¨æˆ·è¡Œä¸ºåŸ‹ç‚¹ + æ•°æ®åˆ†æ + APMç³»ç»Ÿ. |

ä»¥ä¸Šè¡¨æ ¼ä¸­æˆ‘ä»¬å¯ä»¥æ•²é‡ç‚¹æ¥çœ‹é€šç”¨çš„éƒ¨åˆ†ï¼š**è¯„ä¼°æ–¹æ³•.**

å¯ä»¥çœ‹åˆ°è¯¥æ¨¡å‹ä¸‹é™¤äº†åœ¨**æ„‰æ‚¦åº¦**æŒ‡æ ‡é¡¹éœ€è¦ç”¨æˆ·ä¸»è§‚çš„è¯„ä¼°ï¼ˆNPSè°ƒç ”ï¼‰ï¼Œå…¶ä½™äº”é¡¹å®Œæ•´çš„å‡éœ€è¦ç”¨æˆ· **"è¡Œä¸ºåŸ‹ç‚¹ + æ•°æ®åˆ†æ."**

è€ŒAPMç³»ç»Ÿå‡ºç°åœ¨äº† **æ„‰æ‚¦åº¦ åŠ ä»»åŠ¡å®Œæˆç‡**ã€‚å®ƒçš„èŒè´£æ›´å¤šçš„æ˜¯å»è¯„ä¼°ç”¨æˆ·æ˜¯å¦åœ¨æ“ä½œè¿‡ç¨‹ä¸­å‡ºç°è¿‡å¼‚å¸¸ä¸ä½³çš„åœºæ™¯ï¼Œä¹ƒè‡³å‡ºç°ä¸¥é‡çš„Block.

- ä¸¾ä¾‹Case è§ä¸‹å›¾ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741933871906-2c67d0a6-70c3-44a0-a02c-34d4d86b9dee.png)

# äºŒã€What - å½“å‰ç°çŠ¶åŠå¯æ”¹è¿›çš„éƒ¨åˆ†.

- å½“å‰æˆ‘ä»¬å·²æ¥å…¥äº† **å‹ç›Ÿ + Arms**ï¼ŒåŸåˆ™ä¸Šåº”è¯¥æ˜¯å¯ä»¥æ»¡è¶³åº”ç”¨**Google Heart** æ¨¡å‹å»ºè®¾ã€‚
- ä½†é€šè¿‡è°ƒç ”Armsåå‘ç°å½“å‰åŠŸèƒ½æ— æ³•æ”¯æŒåç»­çš„**æŒ‡æ ‡åˆ¶å®šåŠæ•°æ®æµ‹é‡ï¼Œå¹¶å¯¹æ•…éšœæ’æŸ¥è¾ƒä¸ºå›°éš¾**.

### åŸå› å¦‚ä¸‹ï¼š

| **ç»´åº¦** | **ä¼˜åŠ¿** | **åŠ£åŠ¿** | **å…¶åŠ£åŠ¿å¸¦æ¥çš„æ„ä¹‰** |
| --- | --- | --- | --- |
| ä¼šè¯è·Ÿè¸ª | å¯è§‚æµ‹å•ä¸€ç”¨æˆ·ã€ä¼šè¯è¿›è¡Œè¡Œä¸ºè¿½æº¯ï¼ˆå«è¡Œä¸ºã€é¡µé¢è¿½æº¯ã€æ¥å£è¿½æº¯ï¼‰ | 1. ç”¨æˆ·è¡Œä¸ºæ¼æŠ¥è¾ƒå¤šï¼Œå¹¶åªæœ‰ç®€å•çš„clickäº‹ä»¶2. æ²¡æœ‰èšåˆä¿¡æ¯åçš„æ—¶é—´æ»‘åŠ¨çª—å£çœ‹æ¿ï¼Œå¯è§†åŒ–èƒ½åŠ›è¾ƒå·®. | ç›´è§‚çš„æ„ŸçŸ¥ç”¨æˆ·å…¨ç”Ÿå‘½å‘¨æœŸçš„çš„è¡Œä¸ºè·¯å¾„åŠç³»ç»Ÿå‘ç”Ÿäº‹ä»¶. æœ‰å¾…æå‡. |
| é¡µé¢è®¿é—® | æ—  | 1. è¯¥é¡µé¢Native åªæœ‰åŠ è½½è€—æ—¶ç»Ÿè®¡ | ä»å®é™…è€—æ—¶æ¥çœ‹ - è¯¥å£å¾„ä¸ºonResume ç”Ÿå‘½å‘¨æœŸï¼ˆWindow æŒ‚è½½æ—¶é—´èŠ‚ç‚¹ï¼‰ã€‚ä¸å®é™…æ¸²æŸ“æ— å…³. |
| èµ„æºåŠ è½½ | H5è¾ƒä¸ºå‹å¥½ï¼Œå¯¹jsã€htmlã€imgã€cssç­‰å„é¡¹èµ„æºå‡è¿›è¡Œç½‘ç»œç›‘æ§. | Native ç›®å‰åªæœ‰API è¯·æ±‚èµ„æºç›‘å¬ï¼Œå¯¹Fileç›¸å…³èµ„æºæ— ç›‘å¬ | Nativeçš„å›¾ç‰‡èµ„æºã€æ–‡ä»¶è¯»å†™ç­‰ç›‘æ§ç¼ºå¤±ã€‚å…¶å¯¹å†…å­˜ã€å¡é¡¿ä¸¤éƒ¨åˆ†ç¼ºä¹å¯¹åº”æ¨¡å—çš„å½’å› èƒ½åŠ›. |
| APIè¯·æ±‚ | æœ‰å®Œå–„çš„traceç³»ç»Ÿï¼Œå¯åŸºäºAPI å®šä½åç«¯è€—æ—¶åˆ†å¸ƒ. | trace ID æœªä¸ç«¯è¿›è¡Œç»‘å®šï¼Œå®¢æˆ·ç«¯æ¥å£ä¸æ¥å£ä¹‹é—´äº¤äº’æ— æ³•é€šè¿‡traceè¿›è¡Œå…³è”. | trace æ²¡æœ‰åšåˆ°çœŸæ­£æ„ä¹‰ä¸Šçš„å…¨é“¾è·¯è¿½è¸ªï¼Œå½“å‰ä»…é™äºæœåŠ¡ä¾§. |
| å¼‚å¸¸ç»Ÿè®¡ | ä¼˜äºBuglyçš„å¼‚å¸¸ç±»å‹å½’ç±» | 1. ç¼ºä¹å®é™…è°ƒç”¨å †æ ˆä¿¡æ¯.2. ANR ä¿¡æ¯ä¸¥é‡ç¼ºå¤±.3. ç¼ºä¹ç°åœºè¿˜åŸä¿¡æ¯ï¼šå†…å­˜ã€CPUã€ç”¨æˆ·è¡Œä¸ºç­‰æ•°æ® | ç°åœºè¿˜åŸèƒ½åŠ›ä¸è¶³ä»è€Œå¯¼è‡´RDé—®é¢˜å®šä½æ•ˆç‡è¾ƒä½. |
| å¡é¡¿ç»Ÿè®¡ | æ—  | é™„å¸¦ä¿¡æ¯è¾ƒå°‘ï¼Œåªæœ‰åŸºç¡€çš„å †æ ˆä¿¡æ¯ | æ’æŸ¥éš¾åº¦è¾ƒå¤§ï¼Œå…¨æ˜¯ç³»ç»Ÿå±‚é¢é€šç”¨å †æ ˆã€‚å‚è€ƒä»·å€¼è¾ƒå° |
- **é¡µé¢åŠ è½½é€Ÿåº¦**
    
    ![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741934052891-46445983-3e30-4273-9249-731a6774c16f.png)
    

### åŸºäºä¸ŠArmså„ç»´åº¦åˆ†æå‘ç°ï¼š

**ä¼˜åŠ¿ï¼š** ç”¨æˆ·ä½“éªŒçš„æ¯ä¸ªå¤§æ¨¡å—å‡æ¶‰åŠï¼Œè¾ƒä¸ºå…¨é¢. å¹¶åœ¨åç«¯Tracesè¿½æº¯è¾ƒä¸ºä¼˜ç§€.

**åŠ£åŠ¿ï¼š**

1. æŒ‡æ ‡æ¨¡ç³Šï¼šæ¯ä¸ªæ¨¡å—ä¸‹çš„å‡æœ‰å¤§è‡´æŒ‡æ ‡ï¼Œä½†è¿™äº›æŒ‡æ ‡æ— æ³•å»ºè®¾æ­£å‘çš„ç”¨æˆ·ä½“éªŒæ¨¡å‹ï¼ˆå¯¹åº” Heartï¼‰
2. æ’æŸ¥å›°éš¾ï¼šå½“å‰å¼‚å¸¸æƒ…å†µä¸‹ï¼Œç°åœºè¿˜åŸä¿¡æ¯è¾ƒå°‘.

æ¼æŠ¥æ•°æ®é¡¹ï¼Œå½“å‰æ²¡æœ‰æ‰‹æ®µå»ç§‘å­¦çš„è¯å®ï¼Œ ä¸ä½œä¸ºå½“å‰åˆ†æé¡¹.

# ä¸‰ã€How - æ€ä¹ˆåšï¼Ÿ

åŸºäºä¸Šåˆ†æç‚¹ï¼Œæˆ‘å¯ä»¥ä»Armsç¼ºå¤±çš„éƒ¨åˆ†å¹¶é›†åˆæˆ‘ä»¬å½“å‰çš„é—®é¢˜è¿›è¡Œè”åŠ¨æ”¹é€ ã€‚

APMå»ºè®¾ä¸ºè¾…ã€‚ä»è€ŒçœŸæ­£åšåˆ°å¯å®šä¹‰ã€å¯æµ‹é‡çš„è·¯å¾„ã€‚

### 1. ä»¥ä¸‹ä¸º Android å¯åŠ¨æ—¶æ®µçš„ç«ç„°å›¾ï¼Œå…¶æˆªæ­¢åˆ°é¦–é¡µæ¸²æŸ“çš„ç¬¬ä¸€å¸§ï¼š 7s

### FMP. å®é™…è€—æ—¶ï¼š 7sï¼ˆpsï¼šæœ¬åœ°åˆ†æ çº¦æœ‰5 ~ 8%çš„æ€§èƒ½æŸè€— ï¼Œå¹¶ä¸”åŒ…å«600msçš„ æ¬¢è¿é¡µï¼‰

**å®é™…è€—æ—¶é¢„æµ‹å…¬å¼ï¼š7000 * 0.92 - 600  = 5840ms ï¼ˆ5.84sï¼‰**

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741935995334-69b5cd66-1eab-44da-b8b9-97a27125d52b.png)

### 2. å…¶ä¸­ Application.onCreate() æ‰§è¡Œå®Œæˆå‰ï¼šè€—æ—¶ï¼š2.5s

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936126789-4bff43d2-4404-4306-82f0-dda0628005ab.png)

- **å…·ä½“Code.**
    
    ```jsx
    fun initThirdSdk() {
        UmengInitializer.init(Utils.getApp())
        if (!ProcessUtil.isMainProcess()) {
            return
        }
        AppInitializer.getInstance(Utils.getApp()).initializeComponent(
            DYJuLiangInitializer::class.java
        )
        UULogan.init()
        LoganBlackListHelper.init()
        AppInitializer.getInstance(Utils.getApp()).initializeComponent(
                TencentX5Initializer::class.java
        )
        initPreloader()
        RouteUtil.get(IJSPluginService::class.java)
                ?.registerPluginFactory(GLOBAL_JS_PLUGIN_FACTORY, AppModuleJSPluginFactory())
        // ä¸ƒé±¼SDKï¼Œå¿…é¡»åœ¨Appä¸­åˆå§‹åŒ–ä¸èƒ½æ”¾åœ¨CustomerServiceInitializerä¸­
        // ä¸ƒé±¼SDKï¼Œå¿…é¡»åœ¨Appä¸­åˆå§‹åŒ–ä¸èƒ½æ”¾åœ¨CustomerServiceInitializerä¸­
        UUNeTalkHelperV2.getInstance().initUnicorn(Utils.getApp())
    //    initUnicorn(Utils.getApp())
    
        AppInitializer.getInstance(Utils.getApp())
                .initializeComponent(ABConfigExperimentInitializer::class.java)
    //        if (SharePHelper.getInstance().getAliyunReport() == 1)
    //            AppInitializer.getInstance(Utils.getApp()).initializeComponent(AliHaInitializer.class);
        //        if (SharePHelper.getInstance().getAliyunReport() == 1)
    //            AppInitializer.getInstance(Utils.getApp()).initializeComponent(AliHaInitializer.class);
        AppInitializer.getInstance(Utils.getApp()).initializeComponent(ConfigInitializer::class.java)
        if (SharePHelper.getInstance().buglyOpenSwitch == 1) AppInitializer.getInstance(Utils.getApp())
                .initializeComponent(
                        BuglyInitializer::class.java
                )
    
        AppInitializer.getInstance(Utils.getApp()).initializeComponent(
                TrackAndApmInitializer::class.java
        )
        AppInitializer.getInstance(Utils.getApp()).initializeComponent(
                OneKeyLoginInitializer::class.java
        )
        UUPushManager.init(Utils.getApp())
        AppInitializer.getInstance(Utils.getApp()).initializeComponent(
                VerifyFaceInitializer::class.java
        )
        AppInitializer.getInstance(Utils.getApp()).initializeComponent(
                VolcanoInitializer::class.java
        )
        if (DomainSwitch.enable()) {
            DomainHelper.init(Utils.getApp(), DomainSwitch.getHttpErrorThreshold(), false,if (!isPrivacyPolicyAgreed()) {
                UTDevice.getUtdid(Utils.getApp())
            } else {
                ""
            },UUABSwitchManager.getConfig("android_H5ErrorCodeSwitch_v1"))
            Log.d("DomainHelper", BuildConfig.FLAVOR + "")
        }
    
        UUPerformance.enableReport = UUABSwitchManager.hitABTestLogic("enable_apm_android")
    
        initArms(application = CONTEXT.application)
        NormalJsPreloaderHelper.run {
            init(
            blackList = mutableListOf(LeaseTransferShelfH5OrderFragment::class.java,LeaseTransferShelfH5Fragment::class.java, SalePutShelfH5Fragment::class.java, ShelfH5Fragment::class.java),
            pluginList = listOf(NetUtilsPlugin())
        )
        }
    }
    ```
    

**ä¸»è¦è€—æ—¶åˆ†å¸ƒä¸ºï¼š**

| ç±»æ‰§è¡Œï¼š | è€—æ—¶ | å¤‡æ³¨ |
| --- | --- | --- |
| DetailWebViewPreloadHelper | 976 ms | åˆå§‹åŒ– WebView Pool |
| SharePreInitializer | 244 ms | SharedPreferences åˆå§‹åŒ– |
| ArmsInit | 239 ms | Arms åˆå§‹åŒ– |
| NormalJsPreloaderHelper | 191 ms | è§£æurl WebView é¢„åŠ è½½é¡µé¢ |
| **æ€»ç»“ï¼š** | 1650 ms |  |

### 3. é¦–é¡µå¯åŠ¨ + æ¸²æŸ“ç¬¬ä¸€å¸§è€—æ—¶ 3.68s

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936173311-69375850-fa86-42be-8724-be6251d3770e.png)

- **å…·ä½“Code**
    
    ```java
    fun gainConfig(block: ((Boolean) -> Unit)? = null) {
    launchs(block = {
            val model = api.gainUserConfig()
    model.data?.let {
        if (it.contains("730")) {
            it.getJSONObject("730")?.let { csgo ->
                                           RentSettingViewHelper.syncConfig(csgo)
                                           //æ±‚è´­è‡ªåŠ¨æ¥æ”¶æŠ¥ä»·æœåŠ¡å¼€å…³
                                           if (csgo.contains("purchaseAutoReceiveSwitch")) Ukv.putBoolean(
                KEY_ASK_BUY_AUTO_RECEIVE,
                csgo.getInteger("purchaseAutoReceiveSwitch") == 1
            )
    
                if (csgo.contains("inventoryViewSwitch")) {
                SharePHelper.getInstance()
                .saveViewMapStatus(csgo.getInteger("inventoryViewSwitch") == 1)
            }
                                           if (csgo.contains("inventoryThinModeSwitch")) {
                                               SharePHelper.getInstance()
                                               .saveSimpleType(csgo.getInteger("inventoryThinModeSwitch") == 1)
                                           }
                                           if (csgo.contains("inventoryTemplateMergeSwitch")) {
                                               SharePHelper.getInstance()
                                               .saveStockMergeStatus(csgo.getInteger("inventoryTemplateMergeSwitch") == 1)
                                           }
                                           if (csgo.contains("autoRecordPurchasePriceSwitch")) {
                                               SharePHelper.getInstance()
                                               .setPreference_remarkPrice(csgo.getInteger("autoRecordPurchasePriceSwitch") == 1)
                                           }
                                           if (csgo.contains("transactionMode")) {
                                               SharePHelper.getInstance()
                                               .setDefaultTransactionMode(csgo.getInteger("transactionMode"))
                                           }
                                           if (csgo.contains("preSaleCoolEndSellSwitch")) {
                                               SharePHelper.getInstance()
                                               .setDefaultPresaleCoolingMode(csgo.getInteger("preSaleCoolEndSellSwitch"))
                                           }
                                           if (csgo.contains("defaultRentalActivitySwitch")) {
                                               SharePHelper.getInstance()
                                               .setDefaultJoinRentActivity(csgo.getInteger("defaultRentalActivitySwitch") == 1)
                                           }
                                           if (csgo.contains("leaseDays")) {
                                               SharePHelper.getInstance()
                                               .synLeaseDays(csgo.getJSONArray("leaseDays") as MutableList<Int>?)
                                           }
                                           if (csgo.contains("defaultLeaseDays")) {
                                               SharePHelper.getInstance().synDefautLeaseDays(
                                                   csgo.getJSONArray("defaultLeaseDays").toList() as MutableList<Int>?
                                               )
                                           }
                                           if (csgo.contains("leaseListSort")) {
                                SharePHelper.getInstance().putString(
                                    SharePHelper.KEY.K_SORT_PREFERENCE_SELECT,
                                    csgo.getString("leaseListSort")
                                        ?: ""
                                )
                            }
                            if (csgo.contains("easyCompensationOrdinarySwitch")) {
                                // é»˜è®¤é€‰ä¸­èµ”ä»˜æ ‡å‡†çš„å¼€å…³
                                csgo["easyCompensationOrdinarySwitch"]?.let { value ->
                                    LocalDataHelper.setEasyCompensationOrdinarySwitchStatus(value == "1".toDouble())
                                }
                            }
                            if (csgo.contains("compensateSwitch")) {
                                LocalDataHelper.synCompensateSwitch(csgo.getInteger("compensateSwitch"))
                            }
                            if (csgo.contains("depositCompensateType")) {
                                LocalDataHelper.synCompensateType(csgo.getInteger("depositCompensateType"))
                            }
                            if (csgo.contains("autoFillDepositSwitch")) {
                                val enabled = csgo.getInteger("autoFillDepositSwitch")
                                SharePHelper.getInstance().isAutoFillDeposit = enabled == true.toInt()
                            }
                            if (csgo.contains("depositCoefficient")) {
                                csgo["depositCoefficient"]?.let { value ->
                                    SharePHelper.getInstance()
                                        .setAutoFillDepositCoefficient(value.toString().toFloat())
                                }
                            }
                            if (csgo.contains("fillInRentSwitch")) {
                                val enabled = csgo.getInteger("fillInRentSwitch")
                                Ukv.putBoolean(KEY_AUTO_FILL_LONG_RENT, enabled == true.toInt())
                            }
                            if (csgo.contains("longRentCoefficient")) {
                                csgo["longRentCoefficient"]?.let { value ->
                                    Ukv.putFloat(
                                        KEY_AUTO_FILL_LONG_RENT_COEFFICIENT,
                                        value.toString().toFloat()
                                    )
                                }
                            }
                            SaleCommodityMergeHelper.saveSaleListMergeMode(csgo)
                            NoCDHelper.onGetCurrent(csgo)
                        }
                    }
                    ACache.updateConfig(BaseConfig.USER_CUSTOM_CONFIG, it.toJson())
                }
                block?.invoke(false)
            }, onError = {
                block?.invoke(false)
                UUToastUtils.showShort(it.message)
            })
        }
    ```
    
    ```java
    private fun initFragments(savedInstanceState: Bundle?, mainActivity: MainActivity) {
            mFragments = arrayOfNulls(MAX)
            if (savedInstanceState == null) {
                mFragments!![SECOND] = HomePageV2Fragment.newInstance(HOMETAG)
                mFragments!![THIRD] = StockV2Fragment.newInstance(STOCKTAG)
                mFragments!![FOURTH] = SellV2Fragment.newInstance(SELLTAG)
                mFragments!![FIFTH] = newInstance(ASKTAG)
                mFragments!![SIX] = getUserFragment(mainActivity, false)
                loadMultipleRootFragment(
                    R.id.c_content, GameHelper.currentIndex,
                    mFragments!![SECOND],
                    mFragments!![THIRD],
                    mFragments!![FOURTH],
                    mFragments!![FIFTH],
                    mFragments!![SIX]
                )
            } else {
                mFragments!![SECOND] = findChildFragment(HomePageV2Fragment::class.java)
                mFragments!![THIRD] = findChildFragment(StockV2Fragment::class.java)
                mFragments!![FOURTH] = findChildFragment(SellV2Fragment::class.java)
                mFragments!![FIFTH] = findChildFragment(AskFragment::class.java)
                mFragments!![SIX] = findChildFragment(UserFragmentV3::class.java)
            }
        }
    ```
    

| ç±»æ‰§è¡Œ | è€—æ—¶ | å¤‡æ³¨ |
| --- | --- | --- |
| MainViewModel | 132 ms | åˆå§‹åŒ–MainViewModelï¼Œä¸»è¦ä¸ºåŠ è½½é…ç½®é¡¹ä¿¡æ¯. |
| MainActivity.setContent() + Fragment Viewåˆ›å»º | 1300 ms | åˆ›å»º é¦–é¡µé™æ€å¸ƒå±€ã€View |
| MainActivity.onResume() | 326 ms | æŒ‚è½½ Window |
| Choreographer.doFrame() | 1100 ms | å°†åˆ›å»ºå¥½çš„View ç»˜åˆ¶ è‡³ Windows |
| **æ€»ç»“ï¼š** | 2858 ms |  |

### 4. ç»“è®ºï¼š

- ä»¥ä¸Šä¸º å¯åŠ¨é¡¹çš„é™æ€åˆ†æï¼Œå¯ä»¥çœ‹åˆ°æ‹†å‡ºæ¥éƒ¨åˆ†è€—æ—¶ä¸º **4.3s** å·¦å³. è¯¥éƒ¨åˆ†åç»­å¯èƒ½æŒç»­è¿›è¡Œä¼˜åŒ–.
- ç›®å‰ä¸ºé™æ€åˆ†æå¹¶ä¸”æœºå‹ä¸ºï¼šä¸€åŠ  Ace 2V å…¶ 12Gè¿å­˜. å¹¶ä¸ä¸ºä½ç«¯æœº.
- APMæ¥å…¥åï¼Œæ›´èƒ½ååº”å‡ºçº¿ä¸Šçš„å®é™…æƒ…å†µ.

ğŸ’¡å…³äºAPMå»ºè®¾ï¼Œä¹Ÿå¯ä»¥è€ƒè™‘åˆ°è¡Œä¸ºåŸ‹ç‚¹çš„è”åŠ¨.

# å››ã€Roadmap - è¯¥å¦‚ä½•åˆ¶å®š

å…³äºAPM å»ºè®¾ï¼Œå…¶ä¸­åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†ï¼š**Clienté‡‡æ ·ç³»ç»Ÿ + Logsæ—¥å¿—ç³»ç»Ÿ + Traces ç³»ç»Ÿï¼ˆé“¾è·¯è¿½è¸ªï¼‰ + Metricsï¼ˆæŠ¥è¡¨ç»Ÿè®¡ï¼‰**

æœåŠ¡ç«¯ï¼š[https://github.com/apache/skywalking](https://github.com/apache/skywalking) **24.2K Star**

# 4.1 Logs æ—¥å¿—ç³»ç»Ÿï¼š

åŸºäºå†å²ç»éªŒåŠè¡Œä¸šè¾ƒä¸ºé€šç”¨çš„è§£å†³æ–¹æ¡ˆï¼šELF (Elastic + Logstash + Kibanaï¼‰

å…¶ä¸­æŠ€æœ¯å…¬å¼€æ€§è¾ƒå¥½ï¼Œå…¶ä¸»è¦æˆæœ¬åœ¨äº ES æœåŠ¡ã€å­˜å‚¨æˆæœ¬ + Logstash å®ä¾‹æˆæœ¬.

- ES æœåŠ¡
    
    ![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936275100-042f5303-9dcd-4654-9506-eb8caba24bc8.png)
    
- ES æœåŠ¡å­˜å‚¨ï¼š
    
    ![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936291991-2c1c949a-e1c6-4b7f-9684-fb506ea1c59e.png)
    
- Logstash å®ä¾‹ + å­˜å‚¨ï¼š
    
    ![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936320761-be5f5791-f7f9-454c-8c4d-472f2640ad90.png)
    

# 4.2 Trace ç³»ç»Ÿ:

å†å²è°ƒç ”ï¼Œä½¿ç”¨Twitter å¼€æºæœåŠ¡ï¼šZipkin (

[https://zipkin.io/](https://zipkin.io/)

)

**17.1k Star**

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936362539-fd2aef12-f8ac-4efb-9ffa-354f01e1f112.png)

# 4.3 Metrics ç³»ç»Ÿï¼š

ç‚¹è¯„ï¼šCat ç³»ç»Ÿ. ï¼ˆ [https://github.com/dianping/catï¼‰](https://github.com/dianping/cat%EF%BC%89) 18.8K Star

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936543492-bdb04510-fc53-4ee9-9843-ef5f39d8dd90.png)

# 4.4 å®¢æˆ·ç«¯ï¼šAndrroid / iOS é‡‡æ ·

### æ€§èƒ½ç›‘æ§ï¼šMatrix : [https://github.com/Tencent/matrix](https://github.com/Tencent/matrix) **11.8k Star**

- å…¶ä¸­æ¶µç›– Android/iOS æ€§èƒ½ç›‘æ§æ¨¡å—ã€‚ ä½†é€šè¿‡æ’æŸ¥Android çš„åŸºæœ¬æºç ï¼Œä¼šå‘ç°å¤§å¤šæ•°æ›´æ–°ä¸º3å¹´å‰ã€‚ ä¼šå­˜åœ¨ä¸€å®šçš„å…¼å®¹æ€§é—®é¢˜ï¼ˆä½†å¯ä»¥è§£å†³ï¼‰.

### è¡Œä¸ºåŸ‹ç‚¹ï¼š

- Android å·²æœ‰ç›¸å¯¹æˆç†Ÿæ–¹æ¡ˆ. åŸºäºGradle Plugin + ASM è¾¾æˆ AOPåˆ‡é¢. å¹¶æ”¯æŒæ‰‹åŠ¨åŸ‹ç‚¹ å¡«å……ä¸šåŠ¡æ•°æ®.
- å¹¶ä¸” ç¥ç­–å›¢é˜Ÿ å¯¹å¤–å¼€æº ï¼š[https://github.com/sensorsdata](https://github.com/sensorsdata) ç›®å‰çœ‹æœ€æ–°æ›´æ–°æ—¶é—´ä¸º2å‘¨å‰ï¼Œå¯æ”¯æŒWebã€å°ç¨‹åºã€iOSã€Androidç­‰å„ç«¯è¡Œä¸ºæ— åŸ‹æ—¥å¿—é‡‡æ · SDK. ï¼ˆps: Android Gradle Plugin è¾ƒè€ï¼‰

# 4.5 Web / H5 æ•°æ®é‡‡æ · **5.1K Star**

webfunny_monitor : [https://github.com/a597873885/webfunny_monitor](https://github.com/a597873885/webfunny_monitor)

æœ€åæ›´æ–°äº2å¹´å‰. å…¶ä¸­æ¶µç›–åŸ‹ç‚¹ + æ€§èƒ½ç›‘æ§æ¨¡å—.

# 4.6 ç»Ÿä¸€è§£å†³æ–¹æ¡ˆ ï¼ˆå¼€æºï¼Œä½†ç”±äºæ¶‰åŠé¢è¾ƒå¤šã€‚æœªå®Œæˆç›¸å¯¹å…¨é¢çš„è°ƒç ”.ï¼‰

ç›®å‰é€šè¿‡è°ƒç ”å‘ç°å›½å¤–ä¸€å®¶åä¸ºï¼šSentryçš„ä¼ä¸š - ä¸“æ³¨äºAPM å¹¶å¯¹å¤–å®£ä¼ å¼€æºæ‰€æœ‰ä»£ç ï¼šåŒ…å« å‰ç«¯ + å®¢æˆ·ç«¯ + åç«¯æ•°æ®é‡‡æ · åŠ Traces + Metrics ã€å¯è§†åŒ–é¡µé¢ç­‰å¤šé¡¹é¢†åŸŸä¸€å¹¶å¼€æºã€‚ æä¾›äº†ç›¸å¯¹å…¨é¢çš„è§£å†³æ–¹æ¡ˆ.

[https://github.com/getsentry/sentry](https://github.com/getsentry/sentry) ï¼ˆ**40.3K Star**ï¼‰ä¸ºç›®å‰APMç±»åˆ«å¼€æºé¡¹ç›®ä¸­ Star æœ€é«˜.

å…¶ä¸­å¼€æºçš„å¯è§†åŒ–ç•Œé¢ï¼š

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936569849-9648c67d-7e4d-4069-8b78-ed65e72068b6.png)

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936593304-c3bb7200-d9f7-444e-a96a-8bf0ea8d9bd2.png)

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936654614-118e21cc-5bd6-46c5-877b-a14112358cc6.png)

![](https://cdn.nlark.com/yuque/0/2025/png/1401610/1741936678153-f14cdc50-05c1-4f85-aeda-f6b5dd75b9c3.png)

ğŸ’¡å»ºè®®å¯å‚è€ƒè¯¥å¼€æºé¡¹ç›®ï¼Œè¿›è¡Œå®šåˆ¶åŒ–è¿­ä»£å¼€å‘. æ‰“é€ ä¼ä¸šä¸“æ³¨APM.

# å‚è€ƒæ–‡çŒ®ï¼š

- Google Heartï¼š[https://www.interaction-design.org/literature/article/google-s-heart-framework-for-measuring-ux](https://www.interaction-design.org/literature/article/google-s-heart-framework-for-measuring-ux)
- Application Performance Monitorï¼š
- [https://github.com/a597873885/webfunny_monitor](https://github.com/a597873885/webfunny_monitor)
- [https://github.com/BiBoyang/GoldHouse-for-iOS](https://github.com/BiBoyang/GoldHouse-for-iOS)
- [https://github.com/apache/skywalking](https://github.com/apache/skywalking)
- [https://github.com/openzipkin/zipkin](https://github.com/openzipkin/zipkin)
- [https://github.com/dianping/cat](https://github.com/dianping/cat)
- Sentry Github Repositoriesï¼š[https://github.com/getsentry/sentry](https://github.com/getsentry/sentry)
- è¡Œä¸ºåŸ‹ç‚¹ï¼š
- ç¥ç­– Gihub Repositories ï¼š [https://github.com/sensorsdata](https://github.com/sensorsdata)